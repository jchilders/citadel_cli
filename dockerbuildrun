#!/usr/bin/env zsh

set -e  # Exit script on error

IMAGE_NAME="citadel-cli"
CONTAINER_NAME="citadel-cli"
PORT=5173

echo "ğŸ›   Building Docker image: $IMAGE_NAME..."
if ! docker build -t $IMAGE_NAME .; then
  echo "âŒ Failed to build Docker image"
  exit 1
fi

# Remove existing container if it exists
if docker ps -aq --filter "name=$CONTAINER_NAME" | grep -q .; then
  echo "ğŸ›‘ Removing existing container: $CONTAINER_NAME..."
  docker rm -f $CONTAINER_NAME || echo "âš ï¸  Could not remove container"
fi

echo "ğŸš€ Running container: $CONTAINER_NAME..."
if ! docker run -d --name $CONTAINER_NAME -p $PORT:5173 $IMAGE_NAME; then
  echo "âŒ Failed to start container"
  exit 1
fi

echo "âœ… Container is running. Access the app at http://localhost:$PORT"
echo "ğŸ“‹ To view logs: docker logs -f $CONTAINER_NAME"
echo "ğŸ›‘ To stop: docker stop $CONTAINER_NAME"
